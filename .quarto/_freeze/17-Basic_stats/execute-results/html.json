{
  "hash": "93f722d0e550f20b30e84b586b092c34",
  "result": {
    "markdown": "# Basic stats\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/basic_stats.png){fig-align='center' width=20%}\n:::\n:::\n\n\nThis week we'll learn how to carry out some basic stats. This will involve linear regressions and some t-tests.\n\nCreate and use the directory \"Chapter_17-18\" as the working directory for this chapter. Additionally create a new script called \"Stats.R\" for this chapter.\n\nBefore we continue just a reminder about annotations and code sections.\n\n## Linear regression\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/linear_regression.png){fig-align='center' width=20%}\n:::\n:::\n\n\nLinear regression is a method to model the relationship between two **numeric vectors**. Ultimately we want to produce the predictive equation:\n\n$$\ny = mx + c\n$$\n\nWhere *m* is equal to the gradient and *c* is equal to the intercept. With this we can predict the value of *y* if we know the value of *x* and vice versa.\n\n### Fish market dataset\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/bream.png){fig-align='center' width=30%}\n:::\n:::\n\n\nBefore getting to the analysis we need to read in the data. For this chapter we will be looking at the file **Fish.csv** which contains information of 7 common fish species sold in Fish markets (Source: <https://www.kaggle.com/aungpyaeap/fish-market>).\n\nDownload the file into your \"Chapter_17-18\" directory.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<a href=\"https://m-gemmell.github.io/R_for_everyone/downloads/Fish.csv\">\n<button class=\"btn btn-danger\"><i class=\"fa fa-save\"></i> Download Fish.csv</button>\n</a>\n```\n:::\n:::\n\n\nThe columns for the data are:\n\n-   **Species**: Species of fish (\"Bream\", \"Roach\", \"Whitefish\", \"Parkki\", \"Perch\", \"Pike\", and \"Smelt\").\n-   **Weight**: Weight of the fish in grams.\n-   **Length1**: Vertical length of the fish in centimetres.\n-   **Length2**: Diagonal length of the fish in centimetres.\n-   **Length3**: Cross length of the fish in centimetres.\n-   **Height**: Height of the fish in centimetres.\n-   **Width**: Diagonal width of the fish in centimetres.\n\nThe dataset is primarily interested in predicting the weight of a fish based on its length, height, or width.\n\nFirst step is to **read** in the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfish_df <- read.csv(\"Fish.csv\", check.names = FALSE)\n```\n:::\n\n\nHave a look at the **data frame** and you'll see it looks pretty good with no `NA` values.\n\nFor now we only want to look at the information for the species Bream. Let's create a \"bream_df\":\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Create the data frame\nbream_df <- fish_df[fish_df$Species == \"Bream\",]\n#Check how many rows it has\nnrow(bream_df)\n```\n:::\n\n\nWe are left with 35 data points which should be plenty for our linear regression.\n\n### Scatterplot\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/Scatterplot_2.png){fig-align='center' width=20%}\n:::\n:::\n\n\nBefore we carry out the linear regression we'll create a scatterplot of the two **vectors** we want to compare. For the first instance we will compare **Height** to **Length1** (vertical length).\n\nIn fact before we do, let's change the column name \"Length1\" to \"v_length\" so it is a bit more intuitive for us. Whilst we are at it we'll change the other length column names.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(bream_df)[3:5] <- c(\"v_length\", \"d_length\", \"c_length\")\n```\n:::\n\n\nTime to quickly plot \"v_length\" (x) against \"Weight\" (y):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x = bream_df$v_length, y = bream_df$Weight)\n```\n:::\n\n\nSuper! That looks like a decently linear plot with a positive trend. We will therefore fit the linear model.\n\n### Linear model\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/lm.png){fig-align='center' width=20%}\n:::\n:::\n\n\nWe can fit a linear model with the **function** `lm()`. We simply provide the column names as a formula ( `y_column_name ~ x_column_name` ) similar to the `boxplot()` **function**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- lm(Weight~v_length, data=bream_df)\n```\n:::\n\n\nWe can now add the linear model as a line to our plot with the **function** `abline()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nabline(fit)\n```\n:::\n\n\nWith the line added we also want to add the linear equation to the plot. To do this we need to check the contents of the \"fit\" **variable** first so we know what to add.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit\n```\n:::\n\n\nYou'll see the following two sections:\n\n-   `Call:` Shows the **function** with options you ran to create \"fit\"\n\n-   `Coefficients:`: This contains 2 parts\n\n    -   `(Intercept)`: This is the intercept value of the linear model (*c*)\n    -   `v_length`: This is the gradient values (*m*)\n\nOur next step is to create a **string scalar** containing the linear equation. To do this we can extract the coefficients from the \"fit\" **object** like below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm <- fit$coefficients[2]\nc <- fit$coefficients[1]\n```\n:::\n\n\nIf you print out \"m\" and \"c\" to the console you'll notice they have a different number of decimal places than when displayed through printing \"fit\". We will therefore change these to 2 decimal places with the `round()` **function**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm <- round(m, digits = 2)\nc <- round(c, digits = 2)\n```\n:::\n\n\nNow to use the `paste0()` **function** to create our linear equation as a **string scalar**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlinear_equation <- paste0(\"y = \", m , \"x + \", c)\n```\n:::\n\n\nFinally we will recreate our plot, add the abline, and then add the linear equation. We will add the linear equation with the **function** `text()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x = bream_df$v_length, y = bream_df$Weight)\nabline(fit)\ntext(x = 30, y = 800, labels = linear_equation)\n```\n:::\n\n\nThe `text()` options `x =` and `y =` normally require a bit of trial and error to set it in a nice location. This can be a bit fiddly but is made much easier by making the label smaller (e.g. making the numbers have a smaller amount of decimal places).\n\n## t-test\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/scale.png){fig-align='center' width=20%}\n:::\n:::\n\n\nA t-test can be used to determine if there is a significant difference between the means of two groups.\n\nIn this example we will compare the weights of the fish Bream, Parkki, and Roach. Therefore let's subset our **data frame** so we have three **data frames**, one for each species.\n\nWe already have a \"bream_df\" so we only need to make one for Parkki and one for Roach. Before we do we'll change the column names for \"fish_df\" like we did for \"bream_df\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(fish_df)[3:5] <- c(\"v_length\", \"d_length\", \"c_length\")\nparkki_df <- fish_df[fish_df$Species == \"Parkki\",]\nroach_df <- fish_df[fish_df$Species == \"Roach\",]\n```\n:::\n\n\n### Boxplot\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/boxplot.png){fig-align='center' width=20%}\n:::\n:::\n\n\nBefore carrying out a t-test it can be useful to visualise the difference between groups with a boxplot.\n\nBefore we do this we need to combine the three **data frames** into one. This can be done by binding the rows with `rbind()`. This will combine two provided **data frames** which contain the same number of columns with the same column names.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Combine bream_df and parkki_df\nfish_subset_df <- rbind(bream_df, parkki_df)\n#Now rbind roach_df to our new df\nfish_subset_df <- rbind(fish_subset_df, roach_df)\n```\n:::\n\n\nThere is also `cbind` to combine **data frames** by columns. In this case the **data frames** need to have the same number of rows with the same order and names.\n\nTime for a boxplot!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(Weight~Species, data = fish_subset_df)\n```\n:::\n\n\nWe can clearly see that the weights of Parkki and Roach are very similar to each other but very different to Bream's weight.\n\n### t-test comparison\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/five_percent.png){fig-align='center' width=15%}\n:::\n:::\n\n\nLet us see if what we see visually is also visible statistically.\n\nWe can carry out a t-test with the **function** `t.test()`. Simply provide the **function** with the two **numerical vectors** you would like to compare.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbream_parkki_ttest <- t.test(bream_df$Weight, parkki_df$Weight)\nbream_roach_ttest <- t.test(bream_df$Weight, roach_df$Weight)\nparkki_roach_ttest <- t.test(parkki_df$Weight, roach_df$Weight)\n```\n:::\n\n\nPrint the resulting **variables** to the console and you will see a lot of information. I am sure all these values can say a lot about the data but we are only interested in the p-values.\n\nIn this case we can say the means between the two groups tested are significantly different if the p-value is less than 0.05 (1 in 20).\n\nIt can be a bit annoying to have to look through the `t.test()` output for each result so we'll create a **vector** to contain the p-values for comparisons against Bream.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfish_species_weight_ttests <- c(\n  bream_parkki_ttest$p.value,\n  bream_roach_ttest$p.value\n)\n```\n:::\n\n\nThis is pretty useful but we can't immediately see which comparison each t-test is equal to. Thankfully just like **data frames** have row and column names, **vectors** can have names for each element.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Add the vector names\nnames(fish_species_weight_ttests) <- \n  c(\"bream_vs_parkki\",\"bream_vs_roach\")\n#Look at the vector with the added names\nfish_species_weight_ttests\n```\n:::\n\n\nWe can then index the **vector** through the names.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Access the p-value of Bream against Roach\nfish_species_weight_ttests[\"bream_vs_roach\"]\n#Add the p-value of Parkki against Roach\nfish_species_weight_ttests[\"parkki_vs_roach\"] <- \n  parkki_roach_ttest$p.value\n```\n:::\n\n\nWith our nice **vector** of p-values we can quickly see where the p-value is less than 0.05 (i.e. the means are significantly different) and where it is higher (i.e. the means aren't significantly different).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfish_species_weight_ttests < 0.05\n```\n:::\n\n\nDo these p-values match what you saw in the boxplot?\n\n## Some more useful functions\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/r_toolbox.png){fig-align='center' width=15%}\n:::\n:::\n\n\n### Summary\n\nThe **function** `summary()` can give you some quick summary information for each column of a **data frame**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fish_df)\n```\n:::\n\n\nThis gives you some nice information for your numerical columns:\n\n-   `Min.`: The minimum number\n-   `1st Qu.`: The 25th quartile\n-   `Median`: The median (Middle sorted number)\n-   `Mean`: The average\n-   `3rd Qu.`: The 75th quartile\n-   `Max.`: The maximum number\n\nYou will notice the information given for the \"Species\" column is not very informative as it is a **character** column. However, this would be a lot more descriptive if it was a **factor**.\n\nTherefore we'll change the \"Species\" column to a **factor** and run `summary()` again.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfish_df$Species <- as.factor(fish_df$Species)\nsummary(fish_df)\n```\n:::\n\n\nNow `summary()` shows how many instances of each species is present in the **data frame**.\n\nFor future cases it may better to use `stringsAsFactors = TRUE` with the `read.csv()` **function** when we first read in the file.\n\n### Table\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/table_ikea.png){fig-align='center' width=20%}\n:::\n:::\n\n\nThe `table()` **function** will provide a **vector** containing the number of instances for each **level** in a **factor**. This is pretty much what `summary()` did to a **factor**.\n\nHowever, unlike `summary()` it will also do this for **characters** and **numerics**.\n\n**Note**: Remember to use the **\"Help\"** pane if you are not sure what a **function** does.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Table command for columns from fish_df\ntable(fish_df$Species)\ntable(as.character(fish_df$Species))\ntable(fish_df$Height)\ntable(floor(fish_df$Height))\ntable(as.integer(fish_df$Height))\n#Run table on various numeric vectors\ntable(1:10)\ntable(1:100 * 0)\ntable(1:100 %% 2)\ntable(seq(from = 0, to = 50, by = 0.5) %% 7.5)\ntable(c(1:9,1:8,1:7,1:6,1:5,1:4,1:3,1:2,1))\n#Table will run on logicals too\ntable(1:100 > 50)\ntable(c(\"a\",\"a\",\"b\",\"c\") == \"a\")\n#Create a vector of 20 random numbers between 0 and 10\nrandom_num_vec <- sample(0:10, size = 20, replace = TRUE )\n#table\ntable(random_num_vec)\n#Create a character vector randomly containing 1-10 of the strings\n#\"Book\", \"TV\", and \"Film\" each\nrandom_char_vec <- c(\n  rep(\"Book\", sample(1:10, size = 1)),\n  rep(\"TV\", sample(1:10, size = 1)),\n  rep(\"Film\", sample(1:10, size = 1))\n)\n#Now for table()\ntable(random_char_vec)\n#Can create a quick bar plot with the output from table()\nbarplot(table(random_char_vec))\n```\n:::\n\n\nA few more **functions** were introduced above. I will let you explore them yourself or you can ask me verbally.\n\n## Further resources\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/resources.png){fig-align='center' width=20%}\n:::\n:::\n\n\nBelow are some further resources you can check that will help if you want to do some other plots and figures.\n\n**Quick-R**: <https://www.statmethods.net/index.html>\n\n**R Cookbook**: <https://rc2e.com/>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/font-awesome-5.13.0/css/all.min.css\" rel=\"stylesheet\" />\r\n<link href=\"site_libs/font-awesome-5.13.0/css/v4-shims.min.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}