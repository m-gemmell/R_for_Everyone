{
  "hash": "3cc099626c84e397d965cf9e673fa716",
  "result": {
    "markdown": "# Scatter plots and Box plot\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/large_brush.png){fig-align='center' width=20%}\n:::\n:::\n\n\nLast chapter we learnt how to make Histograms and Line graphs. In this chapter it is Scatter plots and Box plots.\n\nContinue using the directory \"Chapter_13-16\" as the working directory.\n\n## Scatter plot\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/Scatterplot_2.png){fig-align='center' width=20%}\n:::\n:::\n\n\nScatter plots are a great way to compare two matching variables. To make a scatter plot we use the `plot()` __function__ again. This means a lot of what we went through the last chapter will be helpful for this chapter\n\n### Basic examples\nFirst we'll create a simple scatter plot plotting the numbers 1:20 against the same range of numbers times by 2. For this we provide the option `type = \"p\"` to indicate we want the data plotted as points.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x = 1:20, y = (1:20)*2, type = \"p\")\n```\n:::\n\n\nThat was a nice linear plot. We'll make a curve this time. \n\nIn the command we will not include the option `type = \"p\"` as this is the default for `plot()`. \n\nAdditionally we will not provide the option names `x = ` and `y = `. __Functions__ have an order to their options so if you leave out the option names but provide options (in this case __vectors__) it will use the options in the order. In the case of `plot()` it will take the first option as `x = ` and the second option as `y = `. It is common for plotting functions to take x first then y.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(1:20, (1:20)*(1:20))\n```\n:::\n\n\n### Animal sizes\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/blue_whale.png){fig-align='center' width=15%}\n:::\n:::\n\nFor our scatter plot from real data we will look at the sizes of the largest animals in the world. This data is from: https://en.Wikipedia.org/wiki/Largest_organisms\n\nThe data we will be using will contain the following information:\n\n- Animal names\n- Average mass in tonnes\n- Maximum mass in tonnes\n- Average total length in metres\n- Group, In this case are they Mammals or Reptiles\n- Biom, are they aquatic, semiaquatic, or terrestrial\n\nFirst download the file into your \"Chapter_13-16\" directory.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<a href=\"https://m-gemmell.github.io/R_for_everyone/downloads/animal_sizes.csv\">\n<button class=\"btn btn-danger\"><i class=\"fa fa-save\"></i> Download animal_sizes.csv</button>\n</a>\n```\n:::\n:::\n\n<br>\n\nNext, __read__ the data into R. We have included a new option: `stringsAsFactors = TRUE`. This is important for plotting and will be explained more later.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanimal_df <- read.csv(\"animal_sizes.csv\", \n                      row.names = 1, check.names = FALSE,\n                      stringsAsFactors = TRUE\n                      )\n```\n:::\n\n\nCheck the column names with the __function__ `colnames()`. With these column names we can create some quick plots.\n\nWe'll compare the average and maximum weight\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x = animal_df$`Average mass (tonnes)`,\n     y = animal_df$`Maximum mass (tonnes)`)\n```\n:::\n\n\nAverage and maximum weight appear to correlate as expected.\n\nSometimes a quick and easy plot is all you want. If you're not going to present a plot then it doesn't need to be pretty. As long as it is functional it is useful.  \n\nNow let's compare the average weight and length\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x = animal_df$`Average mass (tonnes)`,\n     y = animal_df$`Average total length (m)`)\n```\n:::\n\n\nWith that we can see the following:\n\n- At lower weights (< 20 tonnes) a longer length does not necessarily mean a higher mass\n- At higher weights (>20 tonnes) there appears to be an overall trend of longer lengths equaling higher masses with the animal with the highest mass having the longest length\n\nHowever it is quite hard to see the overall trend in the lower mass animals as they are squashed in a small part of the plot. We can zoom into this part in two different ways\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#First method is to set the x and y limits manually \n#This allows us to choose the specific part to zoom into\nplot(x = animal_df$`Average mass (tonnes)`,\n     y = animal_df$`Average total length (m)`,\n     xlim = c(0,10), ylim = c(0,10))\n#The other method is to subset the data\n#so we only plot the data we want\nplot(x = animal_df[animal_df$`Average mass (tonnes)` < 10,\n                   \"Average mass (tonnes)\"],\n     y = animal_df[animal_df$`Average total length (m)` < 10,\n                   \"Average total length (m)\"])\n#I personally prefer the x and y limit approach\n```\n:::\n\n\nWe can also include the Biom metadata as an aesthetic in the plot\n\n::: {.cell}\n\n```{.r .cell-code}\n#Plot\nplot(x = animal_df$`Average mass (tonnes)`,\n     y = animal_df$`Average total length (m)`, \n     col = as.numeric(animal_df$Biom),\n     pch = 1\n     )\n#Legend\nlegend(x = \"bottomright\", col = 1:nlevels(animal_df$Biom), \n       legend = levels(animal_df$Biom), pch = 1)\n```\n:::\n\n\n## Factors\nThe last command used a lot of __factors__.\n\n__Factors__ are a new __class__! They are a combination of __String__ and __Numeric__. They are useful for categorical data where the same values will appear multiple times.\n\nView the __data frame__ and then check its structure with `str()`. You should notice that the columns Group and Biom are __Factors__ with different amounts of __levels__. \n\nThe Group column has 2 __levels__. Confirm this with the __function__ `levels()` which returns the levels and `nlevels()` which returns the number of __levels__.\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(animal_df$Group)\nnlevels(animal_df$Group)\n```\n:::\n\n\nWhat are __levels__? \n\n__Levels__ are the unique values in a __factor__. __Levels__ also store a matching number. This number determines the order of the levels. In the case of Group \"Mammal\" is assigned the number 1 and \"Reptile\" is assigned the number 2. This is because numbers are assigned to __Levels__ in alphabetical order by default.\n\nThe other part of a __factor__ is the __elements__. The __elements__ are the part of a __vector__ we are familiar with. Let us look at the __factor vector__\n\n::: {.cell}\n\n```{.r .cell-code}\nanimal_df$Group\n```\n:::\n\n\nIt looks just like a __character vector__ except there are no double quotes and the __levels__ are at the bottom.\n\nHowever, the __elements__ are actually numbers! Each number is assigned a __string__ by the __level__. This means:\n\n- The __factor__ only needs to store a number for each __element__ and then it stores each unique __level__ only once. This will take up less memory than storing a __string__ multiple times.\n- A __factor__ can be used as a __numeric__ or a __string__. This is very useful for plotting.\n\nIf you don't understand __factors__ from that explanation that is fine. I find it is a hard concept to explain or understand. \n\nAn analogy would be a map key. You could just write \"town\", \"Mountain\", \"railroad\", \"Lake\" over a map to say where everything is like below:\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/town_words.png){fig-align='center' width=40%}\n:::\n:::\n\n\nCompare this to our map with symbols and a key:\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/town_symbols.png){fig-align='center' width=40%}\n:::\n:::\n\n\nThe key represents the __levels__ with our unique __strings__ corresponding to symbols (numbers). Instead of each string being stored on the map multiple times only the symbols (numbers) are.\n\nTime for a more practical example with code. We will first create a __character vector__ then create a __factor__ from it with the __function__ `factor()`. We'll then see what we can do with a __factor__.\n\n::: {.cell}\n\n```{.r .cell-code}\n#Create a character vector\nchar_vec <- c(\"a\",\"b\",\"a\",\"a\",\"b\",\"d\",\"d\",\"c\")\n#Attempt to convert it to a numeric\nas.numeric(char_vec)\n#As expected this does not work and will give NAs\n\n#Create a factor vector from our previous character vector\nfactor_vec <- factor(char_vec)\n#Look at the factor\n#You will notice that even though d is present in an earlier element\n#c is the 3rd level whilst d is the 4th level\n#This is because levels are ordered alphabetically\nfactor_vec\n#Convert to string\nas.character(factor_vec)\n#Convert to numeric\nas.numeric(factor_vec)\n```\n:::\n\n\nWe will get back to plotting soon but first I want to show you how to specify the order of __levels__. This is important as a lot of the time alphabetically is not wanted. One example is with months.\n\n::: {.cell}\n\n```{.r .cell-code}\n#Create a factor vector of months\n#We'll only include the 1st 3 months for brevity\nmonths_factor_vec <- factor(c(\"jan\",\"jan\",\"feb\",\"jan\",\"feb\",\n                     \"feb\",\"mar\",\"jan\",\"feb\",\"mar\"))\n#Check the vector and you will notice feb is before jan in the levels\nmonths_factor_vec\nlevels(months_factor_vec)\n#Before reordering our factor we will create a vector string\n#This will contain our levels in the order we want\n#They must contain the same spelling as the existing levels\nmonths_order_vec <- c(\"jan\",\"feb\",\"mar\")\n#We use the factor function on our factor\n#But we include the option levels providing the ordered character vector\nmonths_factor_vec <-factor(months_factor_vec, \n                           levels = months_order_vec)\n#Check the factor now\nmonths_factor_vec\nlevels(months_factor_vec)\n```\n:::\n\n\nNow let us make a nice scatter plot of the animal data with points coloured by Biom and shaped (`pch =`) by Group.\n\n::: {.cell}\n\n```{.r .cell-code}\n#Plot\nplot(x = animal_df$`Average mass (tonnes)`,\n     y = animal_df$`Average total length (m)`, \n     col = as.numeric(animal_df$Biom),\n     pch = as.numeric(animal_df$Group),\n     xlab = \"Average mass in tonnes\",\n     ylab = \"Average total length in metres\",\n     main = \"The mass and length of the largest animals\"\n     )\n#Legend for biom colours\nlegend(x = \"bottomright\", col = 1:nlevels(animal_df$Biom), \n       legend = levels(animal_df$Biom), pch = 1)\n#Legend for group shapes\nlegend(x = \"bottom\", col = \"black\", \n       legend = levels(animal_df$Group), \n       pch = 1:nlevels(animal_df$Group))\n```\n:::\n\n\nQuite a complicated plot but now we can see:\n\n- Mammals are larger than Reptiles\n- Semiaquatic reptiles are larger than Aquatic and Terrestrial reptiles\n\nWhy do you think the above 2 points are true? Check out what specific animals are in the __data frame__ animal_df to confirm your thoughts or help to figure it out.\n\nHopefully that has helped you figure out what a __factor__ is. If not give it a break and let us do some more plots. Hopefully it will click a bit more over time.\n\nIf not some more tutorials are:\nhttps://swcarpentry.github.io/r-novice-inflammation/12-supp-factors/index.html\nhttps://www.tutorialspoint.com/r/r_factors.htm\n\nWorking with factors resource: https://departmentfortransport.github.io/R-cookbook/factors.html\n\n\n## Box plot\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/boxplot.png){fig-align='center' width=20%}\n:::\n:::\n\n\nNext we are going to make a box plot with some Penguin data from:\nhttps://allisonhorst.github.io/palmerpenguins/\n\nThis data contains information on individual penguins that were gathered from Palmer Station LTER. \n\nFirst download the file into your \"Chapter_13-16\" directory.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<a href=\"https://m-gemmell.github.io/R_for_everyone/downloads/penguin.tsv\">\n<button class=\"btn btn-danger\"><i class=\"fa fa-save\"></i> Download penguin.tsv</button>\n</a>\n```\n:::\n:::\n\n<br>\n\nAs you expect the next step is to __read__ in the file. This time the file is a tsv (tab separated file) with no row names. We will ensure that columns containing strings are converted to __factors__.\n\n::: {.cell}\n\n```{.r .cell-code}\npenguin_df <- read.csv(\"penguin.tsv\", \n                      check.names = FALSE,\n                      stringsAsFactors = TRUE,\n                      sep = \"\\t\"\n                      )\n```\n:::\n\n\nEach row is a measurement of a penguin. The columns for this __data frame__ are:\n\n- species: Species of Penguin\n- island: Island the Penguin was found on\n- bill_length_mm: The bill length of the Penguin in millimetres\n- bill_depth_mm: The bill depth of the Penguin in millimetres\n- flipper_length_mm: The flipper length of the Penguin in millimetres\n- body_mass_g: Weight of Penguin in grams\n- sex: female or male\n- year: Year the measurement was carried out in\n\nWith all that information we'll make a nice boxplot to show the body mass against the species.\n\nThe __function__ `boxplot()` can be used with this. This __function__ is different than the others where the first option is `yaxis_column_name~xaxis_column_name`. This is followed by the option `data = ` where you provide the __data frame__.\n\nBelow is the command for this:\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(body_mass_g~species, data = penguin_df)\n```\n:::\n\n\nWhat if we want to split the 3 box plots into sex? \n\nWe can do that like below:\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(body_mass_g~species*sex, data = penguin_df,\n        col = c(\"yellow\",\"green\"))\n```\n:::\n\n\nI will show you some more examples followed by a final nice plot.\n\nx axis = island, y axis = flipper length\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(flipper_length_mm~island, data = penguin_df)\n```\n:::\n\n\nx axis = island, y axis = bill depth\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(bill_depth_mm~island, data = penguin_df)\n```\n:::\n\n\nx axis = bill length, y axis = species and sex\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(bill_length_mm~species*sex, data = penguin_df)\n```\n:::\n\n\nWhat happens if we try to plot a __factor__ on the y axis?\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(island~species*sex, data = penguin_df)\n```\n:::\n\nIt does not work as an object with __class__ __factor__ can not be added to the x axis __object__.\n\nWhat about a numeric to the x axis?\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(flipper_length_mm~year, data = penguin_df)\n```\n:::\n\nThat works and looks good because it is a discrete set of numbers. In fact you can have a __factor__ where the __levels__ are numerics. If you do this make sure it is a discrete set of numbers.\n\nWhat if we use a continuous set of numbers?\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(body_mass_g~bill_length_mm , data = penguin_df)\n```\n:::\n\nThis does work! However, a scatter plot would most likely be a lot more suited to plotting this data.\n\nWe will now make one final plot for this section. I will not explain what the code is doing. Instead read and run the code to figure it out.\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(body_mass_g~species*year , \n        data = penguin_df, \n        col = c(\"white\",\"grey\",\"orange\"),\n        main = \"Mass of different Penguin species for 2007 - 2009\",\n        xlab = \"Species and year\",\n        ylab = \"Body mass in grams\")\n```\n:::\n\n\n## Saving a plot to a file\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/r_save.png){fig-align='center' width=20%}\n:::\n:::\n\nTo save a plot to a file you can use the __functions__ `png()` and `dev.off()`.\n\nThe __function__ `png()` goes before all the plotting commands. It has various options but the ones we will use are:\n\n- `filename =`: Provide this with a string that will be the filename of the resulting file.\n- `units =`: The units the width and height will be in. the default is \"px\" for pixels but I like to go for \"mm\" for millimetres.\n- `width =`: The width of the plot in the file.\n- `height =`: The height of the plot in the file.\n- `res =`: Resolution of the plot. Usually a number between 50 and 300 with 300 being better quality. This number refers to dpi (dots per inch). \n\nAfter the `png()` and plotting __functions__ you use the __function__ `dev.off()`. This lets R know you are finished plotting and so the file from `png()` will be created.\n\nYou can then look at the plot. If it is not how you would like you can edit the script and rerun from `png()` to `dev.off()`. Through trial and error you can make the plot look how you like.\n\nLet us save the last plot as a png file:\n\n::: {.cell}\n\n```{.r .cell-code}\npng(filename = \"penguin_species_and_year_against_mass.png\",\n    units = \"mm\", width = 50, height = 50, res = 150)\nboxplot(body_mass_g~species*year , \n        data = penguin_df, \n        col = c(\"white\",\"grey\",\"orange\"),\n        main = \"Mass of different Penguin species for 2007 - 2009\",\n        xlab = \"Species and year\",\n        ylab = \"Body mass in grams\")\ndev.off()\n```\n:::\n\n\nLooking at the plot we made the width and height way too small. Therefore let us edit the width and height and then run it again.\n\n__Note__: You will need to close and open the file after running the command to see the new plot.\n\n::: {.cell}\n\n```{.r .cell-code}\npng(filename = \"penguin_species_and_year_against_mass.png\",\n    units = \"mm\", width = 250, height = 250, res = 150)\nboxplot(body_mass_g~species*year , \n        data = penguin_df, \n        col = c(\"white\",\"grey\",\"orange\"),\n        main = \"Mass of different Penguin species for 2007 - 2009\",\n        xlab = \"Species and year\",\n        ylab = \"Body mass in grams\")\ndev.off()\n```\n:::\n\n\nThat overall is much better. But we cannot see all the labels on the x axis. Therefore let us make it wider.\n\n::: {.cell}\n\n```{.r .cell-code}\npng(filename = \"penguin_species_and_year_against_mass.png\",\n    units = \"mm\", width = 400, height = 250, res = 150)\nboxplot(body_mass_g~species*year , \n        data = penguin_df, \n        col = c(\"white\",\"grey\",\"orange\"),\n        main = \"Mass of different Penguin species for 2007 - 2009\",\n        xlab = \"Species and year\",\n        ylab = \"Body mass in grams\")\ndev.off()\n```\n:::\n\n\nSuper! You can save plots in other file formats and there are more options. Check them out with `?png`.\n\nI hope you are ready to make more plots with the Penguin data because it is time for some exercises.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/font-awesome-5.13.0/css/all.min.css\" rel=\"stylesheet\" />\r\n<link href=\"site_libs/font-awesome-5.13.0/css/v4-shims.min.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}