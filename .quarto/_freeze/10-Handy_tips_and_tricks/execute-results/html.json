{
  "hash": "962a610a1c3200c417461b4c2abdf110",
  "result": {
    "markdown": "# Handy tips & tricks\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/magic.png){fig-align='center' width=20%}\n:::\n:::\n\n\nWelcome to Chapter 10! This chapter will include coding to reinforce what you have learnt up to this point. There will also be plenty of new handy **functions** and some more concepts to learn.\n\nFor this chapter create directory called \"Chapter_10-11\" in your main directory and set it as the working directory. Then create a script called \"4-Handy_tips.R\". Remember to use annotations (`#`) and code sections (`####`)!\n\nHowever, I'll first introduce you to some R conventions and then some useful abilities of RStudio.\n\n## R conventions\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/rules.png){fig-align='center' width=20%}\n:::\n:::\n\n\nR conventions are style guides. You do not need to follow them but they are intended to help make code easier to read. There are lots of different suggestions for different parts of R code. Here we will only look at conventions for **object/variable names** and wide vs long code formatting.\n\n### Variable names\n\n**Variable names** have certain rules that must be followed. We covered these in chapter 2 but below is a reminder:\n\n-   Must start with a letter.\n-   Cannot contain spaces.\n-   Cannot start with a number.\n-   Cannot share the same name as a command or function in R.\n-   They are case sensitive. The **variable** name `BB` is different to the **variable** name `bb` which is different again to `bB`.\n\nOn top of these rules there are a few naming styles that are recommended. It is very good to choose one naming style and stick with it always. Below are three commonly used naming conventions for R. Look through them and choose your favourite to use.\n\n#### Snake case\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/snake_case.png){fig-align='center' width=20%}\n:::\n:::\n\n\nSnake case is my preferred naming convention due to my background. It consists of using lower case letters with underscores (`_`) between words. Numbers can also be used. Below are some examples of names in snake case.\n\n\n::: {.cell}\n\n```{.r .cell-code}\none\ntwo_df\ntwo_2_df\nthree_four_five\nthree_four_five_2_vec\nthis_is_snake_case\n```\n:::\n\n\n#### Period separated\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/period_separated.png){fig-align='center' width=20%}\n:::\n:::\n\n\nPeriod separated is almost identical to snake case. Just swap the underscores (`_`) with periods (`.`). Below are some examples of names in period separated.\n\n\n::: {.cell}\n\n```{.r .cell-code}\none\ntwo.df\ntwo.2.df\nthree.four.five\nthree.four.five.2.vec\nthis.is.period.separated\n```\n:::\n\n\n#### Camel case\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/camelCase.png){fig-align='center' width=15%}\n:::\n:::\n\n\nCamel case has no symbols to separate words. Instead after the first word every word starts with an upper case. Below are some examples of names in Camel Case.\n\n\n::: {.cell}\n\n```{.r .cell-code}\none\ntwoDf\ntwo2Df\nthreeFourFive\nthreeFourFive2Vec\nthisIsCamelCase\n```\n:::\n\n\nThere are exceptions when you will want to break your preferred naming style. One such example is when you are creating **vectors** to be used as columns for a **data frame**.\n\n#### Wide vs Long coding\n\nIf a command/**function** is only on one line then you were using **wide** coding. This is good with short commands and **functions** but is not very suitable for longer commands. Below are examples of long commands over one line each.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Create a data frame called df\ndf <- data.frame(one = c(2,4,6), three = c(6,12,18), five = c(10,20,30), row.names = c(\"Two\", \"Four\", \"Six\"))\n#Create a data frame called beach_df_2\nbeach_df_2 <- data.frame(Crab = c(10,1,1,4), Oystercatcher = c(5,6,4,4), Sandpiper = c(1,1,2,3), Starfish = c(3,3,7,4), row.names = c(\"Formby\",\"West Kirby\",\"Crosby\",\"New Brighton\"))\n```\n:::\n\n\nCompare the above with the below **long** coding where arguments are separated by new lines.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Create a data frame called df\ndf <- data.frame(one = c(2,4,6), \n                 three = c(6,12,18), \n                 five = c(10,20,30), \n                 row.names = c(\"Two\", \"Four\", \"Six\"))\n#Create a data frame called beach_df_2\nbeach_df_2 <- data.frame(Crab = c(10,1,1,4), \n                         Oystercatcher = c(5,6,4,4),\n                         Sandpiper = c(1,1,2,3),\n                         Starfish = c(3,3,7,4), \n                         row.names = c(\"Formby\",\"West Kirby\",\"Crosby\",\"New Brighton\"))\n```\n:::\n\n\nHopefully you will agree with me that the long coding is a lot easier and quicker to read.\n\nIf you are interested in more about R style guide I would recommend looking at the following resource: https://style.tidyverse.org/\n\n## RStudio\n\nRStudio has many useful features which we have not covered. Let us remedy this and cover a few.\n\n### Global options\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/global.png){fig-align='center' width=15%}\n:::\n:::\n\n\nTo get to the RStudio Global Options click \"Tools\" in the RStudio Toolbar, then from the drop down menu click \"Global Options..\" . You should see something similar to the below:\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/RStudio_global_options.png){fig-align='center' width=75%}\n:::\n:::\n\n\nHave a look through the \"General\", \"Code\", and \"Appearance\" sections. The other sections are more advanced and I would suggest you ignore them currently.\n\nFeel free to click on options in the \"Appearance\" section to see what they do. If you do not like your choices you can click the \"Cancel\" button to negate your recent choices and close the window. If you want to save your changes you can click the \"Apply\" button.\n\nAlso change the following for later.\n\n1.  Go to Global options.\n2.  Click on the \"Code\" section on the left.\n3.  Click on the \"Completion\" tab at the top.\n4.  Ensure \"Show code completion:\" is set to \"Manually (Tab)\"\n5.  Click \"Apply\" at the bottom followed by \"OK\".\n\nThis will be useful for tab completion which we will cover shortly.\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/RStudio_manual_tab.png){fig-align='center' width=75%}\n:::\n:::\n\n\n### Sweep buttons\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/sweep.png){fig-align='center' width=20%}\n:::\n:::\n\n\nSweep buttons allow you to sweep away items you no longer want in RStudio. There are two main sweep buttons, one for the **Console window** and one for the **Environment pane**.\n\nThe sweep button for the **console window** will clear all the text in the **console pane**. This is useful if you have filled the **console** with lots of commands and **data frames**. This sweep button will not actually affect any of your work so do not be afraid to use it. The location of the sweep button is shown below.\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/RStudio_console_sweep.png){fig-align='center' width=60%}\n:::\n:::\n\n\nThe sweep button for the **Environment pane** is a bit more dangerous. This sweep button will clear all the objects from your environment. This will remove all the **variables** you have created. This is not too bad if you have been using the **script editor** to do your work as you can rerun all your commands to refill your environment. The location of the sweep button is shown below.\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/RStudio_env_sweep.png){fig-align='center' width=60%}\n:::\n:::\n\n\n## Multiplication table\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/multiplication.png){fig-align='center' width=20%}\n:::\n:::\n\n\nHopefully you'll find the above useful. We will learn some new **functions** but before that let us create a quick **data frame**. You are going to make a multiplication table. The **data frame** will be a 10 by 10 table with numbers one to ten as the row names and the column names. The value in each cell/index will be equal to the row name number multiplied by the column name number.\n\nBefore looking at the code below can you think of a way to do this?\n\nThe code below shows a method to create this **data frame**. I have tried to show you a variety of methods to create the **vectors** below for demonstration purposes. Look at each command and make sure you understand how they work before continuing. In real life I would use one of these methods rather than many different methods.\n\n**Tip**: If you double click a word/name in the **script editor** it will highlight it. You can then start typing to replace the highlighted word.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Vectors that will become columns\none <- 1:10\ntwo <- one*2\nthree <- one+two\nfour <- seq(from = 4, to = 40, by = 4)\nfive <- (1:10)*5\nsix <- seq(from = 6, by = 6, length.out = 10)\nseven <- one * (rep(x = 7, 10))\nate <- (1:80)[((1:80) %% 8) == 0]\nnine <- one * (rep(x = 9, 10))\nten <- (seq(100,1000,100))/rep(10,10)\n#Vector for row name\nrow_names <- c(\"one\",\"two\",\"three\",\"four\",\"five\",\n               \"six\",\"sefen\",\"ate\",\"nine\",\"ten\")\n#Create data frame\nmultiplication_df <- data.frame(one, two, three,\n                                four, five, six,\n                                seven, ate, nine, ten,\n                                row.names = row_names)\n```\n:::\n\n\nHave a look at the resulting **data frame**. You may have noticed that two of the row names and one of the column names is incorrect. We'll use the **functions** `colnames()`and `row.names()` along with indexes and assignment to change these.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Change the 8th column name (\"ate\") to \"eight\"\ncolnames(multiplication_df)[8] <- \"eight\"\n#Change the 7th and 8th row names (\"sefen\" and \"ate\") to \"seven\" and \"eight\"\nrow.names(multiplication_df)[7:8] <- c(\"seven\",\"eight\")\n```\n:::\n\n\n## Tab complete\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/tab.png){fig-align='center' width=15%}\n:::\n:::\n\n\nTab completion is a very useful method when coding in any language. It takes some practice to get used to but it increases the speed of coding and drastically reduces typos.\n\nBefore we continue, the tab key is the key above the \"CAPS\" key and left of the 'q' key. If you would like a demonstration of tab completion please ask!\n\nThe first way to tab complete is to tab complete file names. First you will need to download the following files into your \"Chapter_10-11\" directory.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<a href=\"https://m-gemmell.github.io/R_for_everyone/downloads/tea_consumption.csv\">\n<button class=\"btn btn-danger\"><i class=\"fa fa-save\"></i> Download tea_consumption.csv</button>\n</a>\n```\n:::\n:::\n\n\n<br>\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<a href=\"https://m-gemmell.github.io/R_for_everyone/downloads/english_speaking_population_of_countries.tsv\">\n<button class=\"btn btn-danger\"><i class=\"fa fa-save\"></i> Download english_speaking_population_of_countries.tsv</button>\n</a>\n```\n:::\n:::\n\n\n<br>\n\nNext you will run the command that is below. However, when your cursor is in the double quotes first press tab. This will hopefully show a dropdown of selections. There are two ways to then get to your choice:\n\n1.  Use the up and down arrow keys to move to the file name you want and then press enter to have the file name be autofilled.\n2.  Start typing your file name till it is the top choice of the drop down menu. You can then press enter to autofill the file name.\n\nIn this case tab complete should only show \"tea_consumption.csv\" as it is the only file in your working directory.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntea_df <- read.csv(\"tea_consumption.csv\", check.names=FALSE)\n```\n:::\n\n\nYou may notice that we only provided the file name and the `check.names=FALSE` for the `read.csv()` **function**. This is because of the format of the input file. In this case we do not want any of the input columns converted into row names. Additionally, the file was comma separated and the default separator to be used for `read.csv()` is commas. We will come back to this **data frame** so either keep the **variable** in your **environment** or keep the **read** code handy.\n\nLet us **read** in another file using tab complete to autofill the file name again.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenglish_df <- read.csv(\"english_speaking_population_of_countries.tsv\", \n                   sep = \"\\t\", \n                   row.names = 1,\n                   check.names = FALSE)\n```\n:::\n\n\nGreat!\n\nThe second way to use tab completion is to autofill **variable** names, **function** names and options. To autofill a **variable** or **function** name you can start typing the name then press tab to get the dropdown menu.\n\nWhilst in the `()` of a **function** you can press tab to get a drop down menu of the option choices and press enter on the highlighted choice to autofill it.\n\nThis only works if the name currently exists. I.e. you cannot autofill a **variable name** if the **variable** is not in your **environment**.\n\nContinue using tab complete for the rest of the course. Practice makes perfect.\n\nIf you really don't like it you don't have to use it.\n\nData from above files:\n\n-   https://en.wikipedia.org/wiki/List_of_countries_by_tea_consumption_per_capita\n-   https://en.wikipedia.org/wiki/List_of_countries_by_English-speaking_population\n\n## Tea\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/tea.png){fig-align='center' width=20%}\n:::\n:::\n\n\nWe will have a quick look at the \"tea_df\". This data shows the annual consumption of tea per capita with a rank based on the highest to lowest consumers.\n\nUnfortunately the third column has the annual per capita consumption in kilograms (KG) and pounds (LB) with the two values separated by a \"\\_\". Thankfully we can use the **function** `gsub()` to fix this.\n\n`gsub()` will look for a specified pattern and replace it with a specified replacement. `gsub()` is only to be used for **strings**.\n\nBefore fixing our **data frame** I'll show you some examples of `gsub()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Scalar string with mistake\nsentence <- \"The number 8 is spelt ate\"\n#gsub to print out line with mistake fixed\ngsub(pattern = \"ate\", replacement = \"eight\", sentence)\n#We can assign the scalar with the fix\nsentence <- gsub(pattern = \"ate\", replacement = \"eight\", sentence)\n\n#Vector with unwanted capital As\nletter_vec <- c(\"A\",\"Ab\",\"Abc\",\"Abcd\")\n#Replace pattern A with replacement a\nletter_vec <- gsub(pattern = \"A\", replacement = \"a\", letter_vec)\n\n#Vector with unwanted info after \"_\"\nextra_info_vec <- c(\"A_some\",\"B_nada\",\"C_stuff\",\"D_nill\")\n#Replace the _ and everything after it with nothing\n#We signify this with \".*\" which means any character (.) repeated zero or more times (*)\ngsub(pattern = \"_.*\", replacement = \"\", extra_info_vec)\n\n#What if we use gsub() with numerics?\ngsub(pattern = 5, replacement = 2, 1:20)\n#The output will be strings!\n```\n:::\n\n\n`.` and `*` are regular expressions. There are many regular expressions but we will only use `.*` to represent \"all strings\". The best part about this is we can put the `.*` after a specific character to replace the specific character and everything after it. Alternatively we can put the `.*` before a specific character to replace the specific character and everything before it.\n\nLet us carry this out with the \"tea_df\" so it will hopefully make more sense. We are going to do this so we can make a kilogram column and a pound column.\n\n**Note**: Make sure you have the \"tea_df\" in your environment before proceeding.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Create a column for lb (pound). We'll copy the KG_LB_annual_per_capita column\ntea_df$lb <- tea_df$KG_LB_annual_per_capita\n#For the lb column we'll replace the \"_\" and everything before it with nothing\ntea_df$lb <- gsub(pattern = \".*_\", replacement = \"\", tea_df$lb)\n\n#Change the column name KG_LB_annual_per_capita to kg\ncolnames(tea_df)[3] <- \"kg\"\n#For the kg column we'll replace the \"_\" and everything after it with nothing\ntea_df$kg <- gsub(pattern = \"_.*\", replacement = \"\", tea_df$kg)\n\n#Since the columns initially contained \"_\" they are string columns\n#Check if this is correct with the str() function\nstr(tea_df)\n#Change the kg and lb columns to numerics\ntea_df$kg <- as.numeric(tea_df$kg)\ntea_df$lb <- as.numeric(tea_df$lb)\n#Check with str() to see if it is now numerics\nstr(tea_df)\n```\n:::\n\n\nIf you are interested in more regular expressions I would recommend looking at the following resources:\n\n-   https://r4ds.had.co.nz/strings.html#matching-patterns-with-regular-expressions\n-   https://raw.githubusercontent.com/rstudio/cheatsheets/main/regex.pdf\n\n## English speakers across the world\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/language.png){fig-align='center' width=20%}\n:::\n:::\n\n\nNow we will do some processing of the \"english_df\" **data frame**. This shows the various number of english speakers with info on the number of those who have English as a first language and those who have it as an additional language. View the **data frame** to see its contents.\n\nThere are a lot of NA values. Looking at the values in the **data frame** try to figure out the two reasons that these NA values are present. Once you have had a thought you can have a look at the below two reasons.\n\n1.  Some countries have zero population of English first speakers and some countries have zero population of people who speak English as an additional language.\n2.  Some countries are missing data on the number of first and additional speakers, e.g.. Ukraine.\n\nWe will fix these issues one by one. First let us change all NAs to the number 0. The below method requires a lot of R knowledge to understand. I admit I do not fully understand it and I googled to find the answer. In this case the important part is that it works and it is a very short command.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenglish_df[is.na(english_df)] <- 0\n```\n:::\n\n\nWe have changed all NAs. However, some of the rows in the 3rd and 4th column don't equal the 2nd column. We'll now remove these rows as they have missing data and we don't want that here.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#1st method with multiple lines for clarity\n#Create a vector of first language + additional language\nenglish_total_vec <- english_df[,3] + english_df[,\"As an additional language\"]\n#Compare the column of total english speakers against the vector we created above\n#This will create a logical vector (TRUE or FALSE)\nenglish_total_logical_vec <- english_df$`Total English speakers` == english_total_vec\n#Now create a new data frame by indexing the english_df rows by the logical vector\n#This will mean all TRUE rows will be kept and all FALSE rows will not be kept\nenglish_complete_datasets_df <- english_df[english_total_logical_vec,]\n#Remove the vectors we do not need any more\nrm(english_total_vec,english_total_logical_vec)\n\n#2nd method is to carry out the above all in one command\nenglish_complete_datasets_df_2 <- \n  english_df[\n    (english_df$`As first language` + english_df$`As an additional language`) ==\n      english_df$`Total English speakers`,\n    ]\n\n#We can compare our two created data frames with the identical() function\nidentical(english_complete_datasets_df,english_complete_datasets_df_2)\n```\n:::\n\n\nI would use the one command method but the multi line method is just as valid. It doesn't matter if your R code is not as compact as possible. The main things that matter are:\n\n1.  Your code works. When writing your own code make sure you test it with small datasets first so you know it is doing what you think it is doing.\n2.  Your code is well annotated. This will help with the first step and it will help your future self and others who will read your code.\n3.  You can read and understand your own code (annotation helps). There is little point in code you cannot read. You will most likely need to debug code you write (I know I do). Write code in a way that you know you will be able to read. If this means doing little parts over multiple lines then do it that way.\n\nWe will come back to the **data frames** \"tea_df\" and \"english_complete_datasets_df\" for the exercises. But let us go onto 2 more topics.\n\n## Identical\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/identikeys.png){fig-align='center' width=20%}\n:::\n:::\n\n\nI touched on the `identical()` **function** above to compare the two resulting **data frames**. `identical()` will compare two objects and if the objects are exactly identical it will print TRUE. If they are not exactly identical it will print FALSE. The function can be given **scalars**, **vectors**, **data frames** etc. Below are some examples\n\n\n::: {.cell}\n\n```{.r .cell-code}\nidentical(1,1)\nidentical(1,2)\nidentical(\"word\",\"word\")\nidentical(\"word\",\"orb\")\nidentical(1,\"1\")\nidentical(\"one\",1)\nidentical(1:5,1:5)\nidentical(1:5,6:9)\nidentical(1:5,1:6)\nidentical(c(\"a\",\"b\"),c(\"a\",\"b\"))\nidentical(c(\"a\",\"b\"),c(\"c\",\"b\"))\nidentical(c(\"a\",\"b\"),c(\"b\",\"a\"))\nidentical(english_df,english_df)\nidentical(english_df,tea_df)\n```\n:::\n\n\n## Shortcuts\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figures/keyboard.png){fig-align='center' width=30%}\n:::\n:::\n\n\nRStudio has many keyboard shortcuts for the **Script editor**. Some of these are common shortcuts used for other software and some are unique to RStudio.\n\nBelow are a few:\n\n-   \"Ctrl + a\" : This will highlight all text in a **Script editor** that your cursor is in. This is useful to run all your code by highlighting it all and then pressing \"Ctrl + enter\". Be careful though as if you starting typing when all the text is highlighted it will delete it all.\n-   \"Ctrl + z\" : This will undo your last typing action. You can undo your actions till the last time you saved your script. Very useful if you accidentally delete some text.\n-   \"Ctrl + c\" : Copy highlighted text.\n-   \"Ctrl + p\" : Paste text.\n-   \"Ctrl + shift + c\" : This will put a `#` at the start of each highlighted line. This is useful to annotate multiple lines at once. To unannotate the lines, highlight them again and use the shortcut.\n-   \"Ctrl + f\" : This will bring the search and replace menu at the top of the **Script editor**.\n\nThere are a lot more shortcuts. If you want to see the full list go to \"Tools\" on the RStudio toolbar and then select \"Keyboard Shortcuts Help\"\n\nNow time for exercises!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/font-awesome-5.13.0/css/all.min.css\" rel=\"stylesheet\" />\r\n<link href=\"site_libs/font-awesome-5.13.0/css/v4-shims.min.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}